@echo off
SETLOCAL
REM Base extraction folder
SET BASE=%~dp0
cd /d "%BASE%"

REM Ensure portable node exists
IF NOT EXIST "%BASE%portable-node\node.exe" (
  echo ERROR: portable-node\node.exe not found. >&2
  pause
  exit /b 2
)

REM Use bundled Playwright browsers if present
SET PLAYWRIGHT_BROWSERS_PATH=%BASE%my-browsers

REM Log file (in the extracted folder)
SET LOG=%BASE%launcher_stdout.log
echo ===== Launcher run started at %DATE% %TIME% > "%LOG%"

REM Run launcher.js and append stdout+stderr to log
"%BASE%portable-node\node.exe" "%BASE%launcher.js" >> "%LOG%" 2>&1
SET EXITCODE=%ERRORLEVEL%

echo ===== Launcher exited with code %EXITCODE% at %DATE% %TIME% >> "%LOG%"
type "%LOG%"

REM Show the exit code in the console, then pause so a user can read errors
echo.
echo Launcher exit code: %EXITCODE%
pause

exit /b %EXITCODE%
